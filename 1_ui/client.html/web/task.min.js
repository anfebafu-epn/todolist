var ui;(function(n){class t{static Init(){head.load("config.js?v="+(new Date).getTime().toString(),function(){head.load("lib/jquery/jquery-3.7.0.min.js","lib/jsviews/jsviews-1.0.11.min.js","assets/css/main.min.css?v="+current_version,"assets/js/web.js?v="+current_version,"assets/js/Base.js?v="+current_version,"assets/js/proxy.js?v="+current_version,"task.css?v="+current_version,"task.js?v="+current_version,function(){t.Load()})})}static Load(){t.CurrentPersonID=nMorph.framework.common.datatypes.UUID.empty();t.CurrentCategoryID=nMorph.framework.common.datatypes.UUID.empty();var i=sessionStorage.getItem("p");i==null&&window.location.assign("index.html");t.LoggedUser=nMorph.core.proxy.tools.Packager.Unserialize(i);t.LoggedUser.Role==1&&($('a[href="person.html"]').hide(),$('a[href="category.html"]').hide(),t.CurrentPersonID=t.LoggedUser.PersonId);t.LoggedUser.Role==2?($("#personList").append('<button class="filterPerson selected" data-id="'+nMorph.framework.common.datatypes.UUID.empty().toString().toString()+'">All<\/button>'),n.assets.js.Proxy.Person_Search("",n=>{n.forEach(n=>{$("#taskPersonId").append('<option value="'+n.PersonId.toString().toString()+'">'+n.FullName+"<\/option>"),$("#personList").append('<button class="filterPerson unselected" data-id="'+n.PersonId.toString().toString()+'">'+n.FullName+"<\/button>")}),$(".filterPerson").click(n=>{var i=$(n.target).attr("data-id");t.CurrentPersonID=nMorph.framework.common.datatypes.UUID.fromString(i);$(".filterPerson.selected").removeClass("selected").addClass("unselected");$(n.target).addClass("selected");t.fetchTasks()})})):($("#personList").hide(),$("#taskPersonId").append('<option value="'+t.LoggedUser.PersonId.toString().toString()+'">'+t.LoggedUser.FullName+"<\/option>"));$("#categoryList").append('<button class="filterCategory selected" data-id="'+nMorph.framework.common.datatypes.UUID.empty().toString().toString()+'">All<\/button>');n.assets.js.Proxy.Category_Search("",n=>{n.forEach(n=>{$("#taskCategoryId").append('<option value="'+n.CategoryId.toString().toString()+'">'+n.CategoryName+"<\/option>"),$("#categoryList").append('<button class="filterCategory unselected" data-id="'+n.CategoryId.toString().toString()+'">'+n.CategoryName+"<\/button>")}),$(".filterCategory").click(n=>{var i=$(n.target).attr("data-id");t.CurrentCategoryID=nMorph.framework.common.datatypes.UUID.fromString(i);$(".filterCategory.selected").removeClass("selected").addClass("unselected");$(n.target).addClass("selected");t.fetchTasks()})});$(document).on("click",".close",function(){t.closeModal()});$(window).on("click",function(n){const i=$("#editModal");n.target==i[0]&&t.closeModal()});$(document).on("click",".editButton",function(){const n=$(this).data("taskid"),i=t.getTaskById(n,n=>{t.openModal(n)})});$(document).on("click",".completeButton",function(){const i=$(this).data("taskid");window.confirm("Are you sure to set this item complete?")==!0&&n.assets.js.Proxy.Task_SetComplete(nMorph.framework.common.datatypes.UUID.fromString(i),()=>{t.showNotification("Completed!!"),t.fetchTasks()})});$("#btn_Save").click(function(i){i.preventDefault();const u=$("#taskId").val(),f=$("#taskPersonId").val(),e=$("#taskCategoryId").val(),o=$("#taskTitle").val(),s=$("#taskDescription").val(),h=new Date($("#taskDueDate").val()),c=$("#taskIsCompleted").prop("checked");var r=new nMorph.core.db.sw_todolist.Task;r.TaskId=u==""?nMorph.framework.common.datatypes.UUID.newUUID():nMorph.framework.common.datatypes.UUID.fromString(u);r.PersonId=nMorph.framework.common.datatypes.UUID.fromString(f);r.CategoryId=nMorph.framework.common.datatypes.UUID.fromString(e);r.Title=o;r.Description=s;r.DueDate=h;r.IsCompleted=c;n.assets.js.Proxy.Task_Save(r,function(){t.showNotification("Saved");t.closeModal();t.fetchTasks()})});$("#btn_Delete").click(function(i){if(i.preventDefault(),window.confirm("Are you sure to delete this record?")){const i=$("#taskId").val();n.assets.js.Proxy.Task_Delete(nMorph.framework.common.datatypes.UUID.fromString(i),()=>{t.showNotification("Deleted!"),t.closeModal(),t.fetchTasks()})}});$("#searchButton").click(function(){t.fetchTasks()});$("#clearButton").click(function(){$("#searchInput").val("");t.fetchTasks()});$("#newButton").click(function(){t.openModal(null)});t.fetchTasks()}static showTasks(t){const i=$("#tasksContainer");i.empty();t.forEach(t=>{var r=t;const u=$('<div class="dataItem">');u.html(`
                            <span class="itemTitle">${r.Title}</span> 
                            <label>Due Date:</label> <span>${n.assets.js.Utils.DateStringDDMMYYY(r.DueDate)}</span>
                            <label>Assigned To:</label> <span>${r.FullName}</span>
                            <label>Category:</label> <span>${r.CategoryName}</span>
                            <button data-taskid="${t.TaskId}" class="editButton">Edit</button>
                            <button data-taskid="${t.TaskId}" class="completeButton">Set Complete</button>
                          `);i.append(u)})}static openModal(t){const h=$("#editModal"),i=$("#taskId"),r=$("#taskPersonId"),u=$("#taskCategoryId"),f=$("#taskTitle"),e=$("#taskDescription"),o=$("#taskDueDate"),s=$("#taskIsCompleted");t!=null?(i.val(t.TaskId.toString().toString()),r.val(t.PersonId.toString().toString()),u.val(t.CategoryId.toString().toString()),f.val(t.Title),e.val(t.Description),o.val(n.assets.js.Utils.setDateInputValue(t.DueDate)),s.prop("checked",t.IsCompleted)):(i.val(""),r.val("0"),u.val("0"),f.val(""),e.val(""),o.val(""),s.prop("checked",!1));h.show()}static closeModal(){const n=$("#editModal");n.hide()}static fetchTasks(){const i=$("#searchInput").val();n.assets.js.Proxy.Task_Search(i,t.CurrentCategoryID,t.CurrentPersonID,function(n){t.showTasks(n)})}static getTaskById(t,i){n.assets.js.Proxy.Task_GetByID(nMorph.framework.common.datatypes.UUID.fromString(t),n=>{i&&i(n)})}static showNotification(n){const t=document.getElementById("notificationContainer"),i=document.getElementById("notificationMessage");t&&i&&(i.innerText=n,t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("hidden")},5e3))}static CloseSession(){sessionStorage.clear();window.location.assign("index.html")}}n.Task=t})(ui||(ui={}));ui.Task.Init();