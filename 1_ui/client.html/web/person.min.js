var ui;(function(n){class t{static Init(){head.load("config.js?v="+(new Date).getTime().toString(),function(){head.load("lib/jquery/jquery-3.7.0.min.js","lib/jsviews/jsviews-1.0.11.min.js","assets/css/main.min.css?v="+current_version,"assets/js/web.js?v="+current_version,"assets/js/Base.js?v="+current_version,"assets/js/proxy.js?v="+current_version,"person.css?v="+current_version,"person.js?v="+current_version,function(){t.Load()})})}static Load(){var i=sessionStorage.getItem("p");i==null&&window.location.assign("index.html");t.LoggedUser=nMorph.core.proxy.tools.Packager.Unserialize(i);t.LoggedUser.Role==1&&window.location.assign("task.html");$(document).on("click",".close",function(){t.closeModal()});$(window).on("click",function(n){const i=$("#editModal");n.target==i[0]&&t.closeModal()});$(document).on("click",".editButton",function(){const n=$(this).data("personid"),i=t.getPersonById(n,n=>{t.openModal(n)})});$("#btn_Save").click(function(i){i.preventDefault();const o=$("#personId").val(),f=$("#personFullName").val(),u=$("#personEmail").val(),e=$("#personPassword").val(),s=$("#personRole").val();if(f==null||f=="")return alert("Fullname is required.");if(u==null||u=="")return alert("E-mail is required.");if(n.assets.js.Utils.validateEmailFormat(u)==!1)return alert("Invalid e-mail format");if(e==null||e=="")return alert("Password is required.");var r=new nMorph.core.db.sw_todolist.Person;r.PersonId=o==""?nMorph.framework.common.datatypes.UUID.newUUID():nMorph.framework.common.datatypes.UUID.fromString(o);r.FullName=f;r.Email=u;r.PasswordHash=e;r.Role=parseInt(s);n.assets.js.Proxy.Person_Save(r,function(){t.showNotification("Saved");t.closeModal();t.fetchPersons()})});$("#btn_Delete").click(function(i){if(i.preventDefault(),window.confirm("Are you sure to delete this record?")){const i=$("#personId").val();n.assets.js.Proxy.Person_Delete(nMorph.framework.common.datatypes.UUID.fromString(i),()=>{t.showNotification("Deleted!"),t.closeModal(),t.fetchPersons()})}});$("#searchButton").click(function(){const n=$("#searchInput").val();t.searchPersons(n)});$("#clearButton").click(function(){$("#searchInput").val("");t.searchPersons("")});$("#newButton").click(function(){t.openModal(null)});t.fetchPersons()}static showPersons(n){const t=$("#usersContainer");t.empty();n.forEach(n=>{var i=n;const r=$('<div class="dataItem">');r.html(`
                            <label>Name:</label> <span>${i.FullName}</span>
                            <label>E-mail:</label> <span>${i.Email}</span>
                            <label>Role:</label> <span>${i.Role==1?"Executor":"Supervisor"}</span>
                            <button data-personid="${n.PersonId}" class="editButton">Edit</button>
                          `);t.append(r)})}static openModal(n){const e=$("#editModal"),t=$("#personId"),i=$("#personFullName"),r=$("#personEmail"),u=$("#personPassword"),f=$("#personRole");n!=null?(t.val(n.PersonId.toString().toString()),i.val(n.FullName),r.val(n.Email),u.val(n.PasswordHash),f.val(n.Role.toString())):(t.val(""),i.val(""),r.val(""),u.val(""),f.val("1"));e.show()}static closeModal(){const n=$("#editModal");n.hide()}static fetchPersons(){n.assets.js.Proxy.Person_Search("",function(n){t.showPersons(n)})}static searchPersons(i){n.assets.js.Proxy.Person_Search(i,function(n){t.showPersons(n)})}static getPersonById(t,i){n.assets.js.Proxy.Person_GetByID(nMorph.framework.common.datatypes.UUID.fromString(t),n=>{i&&i(n)})}static showNotification(n){const t=document.getElementById("notificationContainer"),i=document.getElementById("notificationMessage");t&&i&&(i.innerText=n,t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("hidden")},5e3))}static CloseSession(){sessionStorage.clear();window.location.assign("index.html")}}n.Person=t})(ui||(ui={}));ui.Person.Init();